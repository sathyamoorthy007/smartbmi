<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart BMI Management - Results</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Quicksand', sans-serif; }
        body { min-height: 100vh; background: #000; color: #fff; overflow-x: hidden; }
        .animated-bg { position: fixed; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; gap: 2px; flex-wrap: wrap; overflow: hidden; z-index: -1; }
        .animated-bg::before { content: ''; position: absolute; width: 100%; height: 100%; background: linear-gradient(#000, #f00, #000); animation: animate 5s linear infinite; }
        @keyframes animate { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .dashboard-container { position: relative; z-index: 1000; background: rgba(34, 34, 34, 0.9); border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); margin: 30px auto; max-width: 1200px; padding: 30px; }
        .hexagon-chart { position: relative; width: 280px; height: 280px; margin: 0 auto; }
        .hexagon { position: absolute; width: 100%; height: 100%; top: 0; left: 0; transition: all 0.5s ease; }
        .hex-segment { position: absolute; width: 100%; height: 100%; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); opacity: 0.5; transform-origin: center; transition: all 0.5s ease; }
        .hex-segment:hover { opacity: 0.8; transform: scale(1.05); }
        .hex-inner { position: absolute; width: 80%; height: 80%; top: 10%; left: 10%; background: rgba(0, 0, 0, 0.7); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); z-index: 2; display: flex; justify-content: center; align-items: center; color: #fff; font-size: 24px; font-weight: bold; }
        #underweight { background: linear-gradient(45deg, #3498db, #2980b9); transform: scale(0.4); animation: pulse 2s infinite alternate; }
        #normal { background: linear-gradient(45deg, #2ecc71, #27ae60); transform: scale(0.6); animation: pulse 2.3s infinite alternate; }
        #overweight { background: linear-gradient(45deg, #f39c12, #e67e22); transform: scale(0.8); animation: pulse 2.6s infinite alternate; }
        #obese { background: linear-gradient(45deg, #e74c3c, #c0392b); transform: scale(1); animation: pulse 2.9s infinite alternate; }
        @keyframes pulse { 0% { opacity: 0.4; transform: scale(0.95) rotate(0deg); } 100% { opacity: 0.8; transform: scale(1.05) rotate(5deg); } }
        .result-value { color: #f00; font-weight: 700; font-size: 1.4em; }
        .comparison-card, .recommendation-card { background: rgba(0, 0, 0, 0.5); border-radius: 10px; border: 1px solid rgba(255, 0, 0, 0.3); padding: 20px; height: 100%; transition: all 0.3s ease; }
        .comparison-card:hover, .recommendation-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(255, 0, 0, 0.3); }
        .card-title { color: #f00; font-weight: 600; font-size: 1.3em; margin-bottom: 15px; text-transform: uppercase; }
        .recommendation-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); animation: fadeIn 0.5s ease-in-out; position: relative; overflow: hidden; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .recommendation-item::before { content: ''; position: absolute; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #f00, transparent); top: 0; left: -100%; animation: slideLine 2s infinite; }
        @keyframes slideLine { 0% { left: -100%; } 50% { left: 100%; } 100% { left: -100%; } }
        .recommendation-header { display: flex; align-items: center; margin-bottom: 8px; position: relative; }
        .recommendation-icon { width: 24px; height: 24px; margin-right: 10px; color: #f00; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .recommendation-title { font-weight: 600; color: #fff; transition: all 0.3s ease; }
        .recommendation-title:hover { color: #f00; text-shadow: 0 0 10px rgba(255, 0, 0, 0.7); }
        .recommendation-text { color: rgba(255, 255, 255, 0.8); font-size: 0.95em; padding-left: 34px; position: relative; animation: textGlow 3s infinite alternate; }
        @keyframes textGlow { 0% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.3); } 100% { text-shadow: 0 0 15px rgba(255, 255, 255, 0.8); } }
        .recommendation-text a { color: #f00; text-decoration: underline; transition: all 0.3s ease; }
        .recommendation-text a:hover { color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
        .btn-back { background: rgba(255, 0, 0, 0.8); border: none; transition: all 0.3s ease; }
        .btn-back:hover { background: #f00; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4); }
        .btn-primary { background: #3498db; border: none; transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .loading-spinner { border: 4px solid rgba(255, 0, 0, 0.3); border-radius: 50%; border-top: 4px solid #f00; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .poly-bg { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1; opacity: 0.1; animation: rotateBg 20s linear infinite; }
        @keyframes rotateBg { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .highlight-pulse { animation: highlightPulse 2s infinite; }
        @keyframes highlightPulse { 0% { background: rgba(255, 0, 0, 0.1); } 50% { background: rgba(255, 0, 0, 0.3); } 100% { background: rgba(255, 0, 0, 0.1); } }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    
    <div class="container dashboard-container">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center text-danger fw-bold mb-3">Smart BMI Management</h1>
                <h3 class="text-center text-white mb-4">Result Dashboard for <span id="nameDisplay">--</span></h3>
                <div class="text-center">
                    <button class="btn btn-danger btn-back mb-4" onclick="location.href='index.html'">‚Üê Back to Home</button>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-md-6">
                <div class="hexagon-chart">
                    <svg class="poly-bg" viewBox="0 0 200 200">
                        <polygon points="100,10 190,50 190,150 100,190 10,150 10,50" stroke="#f00" stroke-width="1" fill="none"/>
                        <polygon points="100,30 170,60 170,140 100,170 30,140 30,60" stroke="#fff" stroke-width="0.5" fill="none"/>
                        <polygon points="100,50 150,70 150,130 100,150 50,130 50,70" stroke="#f00" stroke-width="0.3" fill="none"/>
                    </svg>
                    <div class="hexagon">
                        <div class="hex-segment" id="underweight"></div>
                        <div class="hex-segment" id="normal"></div>
                        <div class="hex-segment" id="overweight"></div>
                        <div class="hex-segment" id="obese"></div>
                        <div class="hex-inner">
                            <span id="bmiDisplay">--</span>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <p class="text-white mb-1">Your BMI</p>
                    <h2 class="result-value" id="bmiValue">--</h2>
                    <p class="text-white mb-0">Category: <span id="bmiCategory" class="fw-bold">--</span></p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="p-3 text-center">
                            <p class="text-white mb-1">Age</p>
                            <h3 class="result-value" id="ageDisplay">--</h3>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 text-center">
                            <p class="text-white mb-1">Height</p>
                            <h3 class="result-value"><span id="heightDisplay">--</span> cm</h3>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 text-center">
                            <p class="text-white mb-1">Weight</p>
                            <h3 class="result-value"><span id="weightDisplay">--</span> kg</h3>
                        </div>
                    </div>
                </div>
                <div class="p-3 mt-3">
                    <h4 class="text-white mb-3">BMI Range Guide</h4>
                    <div class="d-flex justify-content-between mb-2"><span style="color: #3498db">Underweight</span><span class="text-white">< 18.5</span></div>
                    <div class="d-flex justify-content-between mb-2"><span style="color: #2ecc71">Normal Weight</span><span class="text-white">18.5 - 24.9</span></div>
                    <div class="d-flex justify-content-between mb-2"><span style="color: #f39c12">Overweight</span><span class="text-white">25.0 - 29.9</span></div>
                    <div class="d-flex justify-content-between"><span style="color: #e74c3c">Obese</span><span class="text-white">‚â• 30.0</span></div>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-12">
                <div class="comparison-card">
                    <h3 class="card-title">BMI vs Age Group Average</h3>
                    <canvas id="bmiComparisonChart" height="250"></canvas>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="recommendation-card">
                    <h3 class="card-title">Health Insights</h3>
                    <div id="healthInsightsContainer">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="recommendation-card">
                    <h3 class="card-title">Health Prescription Advice</h3>
                    <div id="prescriptionContainer">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12 text-center">
                <button class="btn btn-danger btn-back me-2" onclick="saveRecord()">Save Record</button>
                <button class="btn btn-outline-light" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>

    <script>
        let bmiMeasurements = JSON.parse(localStorage.getItem("bmiMeasurements")) || [];
        let latestMeasurement = bmiMeasurements[bmiMeasurements.length - 1] || {
            name: "User", 
            age: "25", 
            height: "175", 
            weight: "70", 
            bmi: "22.9", 
            category: "Normal Weight"
        };

        document.addEventListener("DOMContentLoaded", function() {
            try {
                document.getElementById("nameDisplay").innerText = latestMeasurement.name || '--';
                document.getElementById("ageDisplay").innerText = latestMeasurement.age || '--';
                document.getElementById("heightDisplay").innerText = latestMeasurement.height || '--';
                document.getElementById("weightDisplay").innerText = latestMeasurement.weight || '--';
                document.getElementById("bmiValue").innerText = latestMeasurement.bmi || '--';
                document.getElementById("bmiCategory").innerText = latestMeasurement.category || '--';
                document.getElementById("bmiDisplay").innerText = latestMeasurement.bmi || '--';
                
                updateIndicator();
                initBMIComparisonChart();
                loadHealthInsights();
                loadPrescriptionAdvice();
                animateHexSegments();
            } catch (error) {
                console.error("Error in DOMContentLoaded:", error);
            }
        });

        function animateHexSegments() {
            try {
                const segments = document.querySelectorAll('.hex-segment');
                segments.forEach((segment, index) => {
                    const delay = index * 150;
                    setTimeout(() => {
                        segment.style.transform = 'scale(1)';
                        setTimeout(() => {
                            if (segment.id === 'underweight') segment.style.transform = 'scale(0.4)';
                            if (segment.id === 'normal') segment.style.transform = 'scale(0.6)';
                            if (segment.id === 'overweight') segment.style.transform = 'scale(0.8)';
                            if (segment.id === 'obese') segment.style.transform = 'scale(1.0)';
                        }, 500);
                    }, delay);
                });
            } catch (error) {
                console.error("Error in animateHexSegments:", error);
            }
        }

        function updateIndicator() {
            try {
                let bmiValue = parseFloat(latestMeasurement.bmi);
                if (isNaN(bmiValue)) return;
                
                const segments = {
                    underweight: bmiValue < 18.5,
                    normal: bmiValue >= 18.5 && bmiValue < 25,
                    overweight: bmiValue >= 25 && bmiValue < 30,
                    obese: bmiValue >= 30
                };
                
                for (const [id, condition] of Object.entries(segments)) {
                    const element = document.getElementById(id);
                    if (element) element.style.opacity = condition ? 0.8 : 0.3;
                }
                
                const categoryToScale = {
                    'Underweight': 0.4,
                    'Normal Weight': 0.6,
                    'Overweight': 0.8,
                    'Obese': 1.0
                };
                
                const category = latestMeasurement.category;
                if (categoryToScale[category]) {
                    const hex = document.querySelector('.hexagon');
                    if (hex) {
                        hex.style.transform = `scale(${categoryToScale[category] * 1.2})`;
                        setTimeout(() => {
                            hex.style.transform = 'scale(1)';
                        }, 500);
                    }
                }
            } catch (error) {
                console.error("Error in updateIndicator:", error);
            }
        }

        function initBMIComparisonChart() {
            try {
                const age = parseInt(latestMeasurement.age) || 25;
                const userBMI = parseFloat(latestMeasurement.bmi) || 22.9;
                const ageGroups = ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80+'];
                const averageBMIs = [15, 18, 22, 24, 25, 26, 25.5, 24.5, 23]; // Sample averages from WHO data
                const userAgeGroupIndex = Math.min(Math.floor(age / 10), ageGroups.length - 1);
                const labels = ageGroups;
                const data = averageBMIs.map((avg, index) => index === userAgeGroupIndex ? userBMI : avg);

                const ctx = document.getElementById('bmiComparisonChart')?.getContext('2d');
                if (!ctx) return;

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Average BMI',
                                data: averageBMIs,
                                backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                borderColor: '#ff0000',
                                borderWidth: 1
                            },
                            {
                                label: 'Your BMI',
                                data: data,
                                backgroundColor: data.map((val, index) => index === userAgeGroupIndex ? '#2ecc71' : 'transparent'),
                                borderColor: '#2ecc71',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        animation: { duration: 2000, easing: 'easeOutBounce' },
                        plugins: { legend: { labels: { color: '#fff' } } },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }, 
                                ticks: { color: '#fff' },
                                title: { display: true, text: 'BMI', color: '#fff' }
                            },
                            x: { 
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }, 
                                ticks: { color: '#fff' } 
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error in initBMIComparisonChart:", error);
            }
        }

        function loadHealthInsights() {
            setTimeout(() => {
                const container = document.getElementById('healthInsightsContainer');
                if (!container) return;
                container.innerHTML = '';
                const age = parseInt(latestMeasurement.age) || 25;
                const bmiValue = parseFloat(latestMeasurement.bmi) || 22.9;
                let insights = [];

                if (age < 20) {
                    insights = [
                        { title: 'Growth Dynamics', text: 'Your body is in a <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/growing-well/">growth phase</a>. Ensure protein intake (0.8g/kg) for muscle development.' },
                        { title: 'Bone Strength', text: 'Calcium (700mg/day) and <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/vitamin-d/">vitamin D</a> are vital for peak bone mass.' },
                        { title: 'Energy Balance', text: 'Teens need 2000-2500 kcal/day per <a href="https://www.who.int/news-room/fact-sheets/detail/malnutrition">WHO</a> to fuel activity.' },
                        { title: 'Hormonal Health', text: 'Puberty impacts <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4266862/">metabolism</a>. Watch for weight fluctuations.' },
                        { title: 'Mental Resilience', text: 'Body image affects <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">mental health</a>. Seek support if needed.' },
                        { title: 'Activity Impact', text: '60 mins/day of <a href="https://www.cdc.gov/healthyweight/assessing/bmi/index.html">exercise</a> builds a healthy foundation.' },
                        { title: 'Immune Boost', text: 'Low BMI may weaken <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6212925/">immunity</a>. Zinc (10mg/day) helps.' },
                        { title: 'Sleep Quality', text: '8-10 hours/night supports <a href="https://www.nhs.uk/mental-health/children-and-young-adults/sleep/">growth</a> and focus.' },
                        { title: 'Nutrition Gaps', text: 'Iron deficiency risks <a href="https://www.nhs.uk/conditions/iron-deficiency-anaemia/">anaemia</a>. Aim for 8-15mg/day.' },
                        { title: 'Hydration Key', text: '6-8 glasses/day per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/water-and-drinks/">NHS</a> aids metabolism.' },
                        { title: 'Screen Time', text: 'Limit to 2 hours/day per <a href="https://www.who.int/news-room/feature-stories/detail/children-and-screen-time">WHO</a> for better posture.' }
                    ];
                } else if (age < 30) {
                    insights = [
                        { title: 'Fitness Peak', text: 'Prime time for <a href="https://www.nhs.uk/live-well/exercise/">fitness</a>. Maintain a balanced BMI.' },
                        { title: 'Metabolic Shift', text: 'Metabolism slows per <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3406222/">studies</a>. Watch calorie intake.' },
                        { title: 'Stress Impact', text: 'Cortisol from stress affects <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/stress-and-eating/">weight</a>.' },
                        { title: 'Muscle Potential', text: 'Build muscle with <a href="https://www.nhs.uk/live-well/exercise/">strength training</a>. BMI may reflect muscle mass.' },
                        { title: 'Diet Quality', text: 'Limit sodium (<2000mg/day) per <a href="https://www.who.int/news-room/fact-sheets/detail/obesity-and-overweight">WHO</a>.' },
                        { title: 'Sleep Regulation', text: '7-9 hours/night balances <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC535701/">hormones</a>.' },
                        { title: 'Heart Health', text: 'Monitor cholesterol via <a href="https://www.nhs.uk/conditions/cholesterol/">NHS</a> guidelines.' },
                        { title: 'Hydration Boost', text: '2L water/day per <a href="https://www.cdc.gov/healthyweight/healthy_eating/water.html">CDC</a> aids energy.' },
                        { title: 'Bone Maintenance', text: 'Calcium (1000mg/day) per <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">NHS</a> prevents early loss.' },
                        { title: 'Mental Clarity', text: 'Exercise reduces <a href="https://www.medicalnewstoday.com/articles/exercise-and-mental-health">anxiety</a> risks.' },
                        { title: 'Gut Wellness', text: 'Fibre (25g/day) from <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">grains</a> supports digestion.' }
                    ];
                } else if (age < 40) {
                    insights = [
                        { title: 'Metabolic Decline', text: 'Calorie needs drop per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/understanding-your-energy-needs/">NHS</a>.' },
                        { title: 'Joint Stress', text: 'High BMI risks <a href="https://www.nhs.uk/conditions/osteoarthritis/">osteoarthritis</a> in knees.' },
                        { title: 'Cardio Risk', text: 'Excess weight raises <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3406222/">triglycerides</a>.' },
                        { title: 'Fertility Impact', text: 'Obesity affects <a href="https://www.nhs.uk/conditions/infertility/">fertility</a> hormones.' },
                        { title: 'Gut Microbiome', text: '30g fibre/day per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">NHS</a> aids health.' },
                        { title: 'Pre-Diabetes', text: 'BMI >25 increases <a href="https://www.cdc.gov/diabetes/basics/prediabetes.html">insulin resistance</a>.' },
                        { title: 'Sleep Apnea', text: 'Weight gain risks <a href="https://www.nhs.uk/conditions/sleep-apnoea/">apnea</a> symptoms.' },
                        { title: 'Skin Health', text: 'Obesity links to <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5608132/">acanthosis nigricans</a>.' },
                        { title: 'Mental Load', text: 'Stress impacts <a href="https://www.medicalnewstoday.com/articles/stress-and-weight-gain">weight gain</a>.' },
                        { title: 'Bone Density', text: 'Maintain via <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">calcium</a> intake.' },
                        { title: 'Energy Levels', text: 'Iron (8mg/day) per <a href="https://www.nhs.uk/conditions/iron-deficiency-anaemia/">NHS</a> prevents fatigue.' }
                    ];
                } else if (age < 50) {
                    insights = [
                        { title: 'Muscle Loss', text: 'Sarcopenia begins per <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4066461/">studies</a>.' },
                        { title: 'Bone Risk', text: 'Osteoporosis risk rises per <a href="https://www.nhs.uk/conditions/osteoporosis/">NHS</a>.' },
                        { title: 'Metabolic Syndrome', text: 'Obesity links to <a href="https://www.nhlbi.nih.gov/health/metabolic-syndrome">hypertension</a>.' },
                        { title: 'Heart Strain', text: 'High BMI increases <a href="https://www.who.int/news-room/fact-sheets/detail/cardiovascular-diseases-(cvds)">CVD</a> risk.' },
                        { title: 'Sleep Issues', text: 'Weight gain causes <a href="https://www.nhs.uk/conditions/sleep-apnoea/">apnea</a>.' },
                        { title: 'Inflammation', text: 'Obesity drives <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5507106/">inflammation</a>.' },
                        { title: 'Diabetes Risk', text: 'BMI >25 elevates <a href="https://www.cdc.gov/diabetes/basics/type2.html">type 2 diabetes</a> odds.' },
                        { title: 'Joint Wear', text: 'Excess weight wears <a href="https://www.nhs.uk/conditions/arthritis/">joints</a>.' },
                        { title: 'Mental Health', text: 'Weight affects <a href="https://www.medicalnewstoday.com/articles/higher-bmi-is-significantly-associated-with-worse-mental-health-especially-in-women">depression</a>.' },
                        { title: 'Skin Changes', text: 'Stretch marks from <a href="https://www.nhs.uk/conditions/stretch-marks/">weight</a> may appear.' },
                        { title: 'Energy Drop', text: 'Maintain via <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/energy-and-fatigue/">B12</a> (2.4mcg/day).' }
                    ];
                } else {
                    insights = [
                        { title: 'Mobility Issues', text: 'High BMI strains <a href="https://www.nhs.uk/conditions/arthritis/">joints</a>.' },
                        { title: 'Heart Load', text: 'Obesity increases <a href="https://www.cdc.gov/heartdisease/risk_factors.htm">heart failure</a> risk.' },
                        { title: 'Bone Fragility', text: 'Low BMI risks <a href="https://www.nhsinform.scot/illnesses-and-conditions/muscle-bone-and-joints/conditions/osteoporosis/">osteoporosis</a>.' },
                        { title: 'Cognitive Decline', text: 'Obesity links to <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6313625/">dementia</a>.' },
                        { title: 'Malnutrition', text: 'Low BMI signals <a href="https://www.who.int/news-room/fact-sheets/detail/malnutrition">risk</a>. Aim for 1500-1800 kcal.' },
                        { title: 'Frailty', text: 'Low BMI increases <a href="https://www.nhs.uk/conditions/falls/">fall risk</a>.' },
                        { title: 'Immune Weakness', text: 'Poor nutrition affects <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6212925/">immunity</a>.' },
                        { title: 'Sleep Quality', text: 'Weight impacts <a href="https://www.nhs.uk/conditions/insomnia/">sleep</a> patterns.' },
                        { title: 'Skin Aging', text: 'Nutrition affects <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/vitamin-a/">skin health</a>.' },
                        { title: 'Energy Needs', text: 'Maintain via <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/vitamins-and-minerals-for-older-adults/">vitamin D</a> (10mcg/day).' },
                        { title: 'Digestive Health', text: 'Fibre (20g/day) per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">NHS</a> aids gut.' }
                    ];
                }

                if (bmiValue < 18.5) {
                    insights.push({ title: 'Underweight Concerns', text: 'Risk of <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/underweight-and-weight-loss/">malnutrition</a>. Consult a doctor.' });
                } else if (bmiValue >= 30) {
                    insights.push({ title: 'Obesity Risks', text: 'Higher chance of <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/healthy-eating-and-weight-management/understanding-obesity/">diabetes</a> and heart disease.' });
                }

                insights.forEach((insight, index) => {
                    const item = document.createElement('div');
                    item.className = 'recommendation-item';
                    item.style.animationDelay = `${index * 0.1}s`;
                    if (index % 2 === 0) item.classList.add('highlight-pulse'); // Add pulse to alternate items
                    item.innerHTML = `
                        <div class="recommendation-header">
                            <h5 class="recommendation-title">${insight.title}</h5>
                        </div>
                        <p class="recommendation-text">${insight.text}</p>
                    `;
                    container.appendChild(item);
                });

                const refItem = document.createElement('div');
                refItem.className = 'recommendation-item highlight-pulse';
                refItem.innerHTML = `
                    <div class="recommendation-header">
                        <h5 class="recommendation-title">Further Research</h5>
                    </div>
                    <p class="recommendation-text">Explore more at <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/">NHS Inform</a>, <a href="https://www.nhs.uk/live-well/healthy-weight/">NHS UK</a>, <a href="https://www.cdc.gov/healthyweight/assessing/bmi/index.html">CDC</a>, and <a href="https://www.who.int/health-topics/obesity">WHO</a>.</p>
                `;
                container.appendChild(refItem);
            }, 1000);
        }

        function loadPrescriptionAdvice() {
            setTimeout(() => {
                const container = document.getElementById('prescriptionContainer');
                if (!container) return;
                container.innerHTML = '';
                const age = parseInt(latestMeasurement.age) || 25;
                const bmiValue = parseFloat(latestMeasurement.bmi) || 22.9;
                let advice = [];

                if (age < 20) {
                    advice = [
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Super Fuel', text: 'Eat 5 portions of <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fruit-and-vegetables/">fruit/veg</a> daily‚Äîbananas rock!' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Move Like a Hero', text: '60 mins/day of <a href="https://www.nhs.uk/live-well/exercise/">activity</a>‚Äîrun or jump!' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Sleep Boost', text: '8-10 hours/night per <a href="https://www.nhs.uk/mental-health/children-and-young-adults/sleep/">NHS</a> for growth.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Smart Snacks', text: 'Nuts over candy per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/healthy-snacking/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Check Growth', text: 'Yearly <a href="https://www.nhs.uk/conditions/bmi/">BMI</a> checks.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v4"/></svg>', title: 'Hydrate Up', text: '6-8 glasses/day per <a href="https://www.cdc.gov/healthyweight/healthy_eating/water.html">CDC</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Bone Power', text: 'Milk for <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">calcium</a> (700mg/day).' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Iron Intake', text: '8-15mg/day per <a href="https://www.nhs.uk/conditions/iron-deficiency-anaemia/">NHS</a> for energy.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Mind Care', text: 'Relax with <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">mindfulness</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Screen Break', text: '2 hours max/day per <a href="https://www.who.int/news-room/feature-stories/detail/children-and-screen-time">WHO</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Posture Fix', text: 'Stretch via <a href="https://www.nhs.uk/live-well/exercise/">yoga</a> daily.' }
                    ];
                } else if (age < 30) {
                    advice = [
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Fitness Kick', text: '150 mins/week of <a href="https://www.nhs.uk/live-well/exercise/">exercise</a>‚Äîjog on!' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Eat Smart', text: '<6g salt/day per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/the-eatwell-guide/">Eatwell</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'BP Check', text: 'Yearly <a href="https://www.nhs.uk/conditions/blood-pressure-test/">BP test</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v4"/></svg>', title: 'Stay Hydrated', text: '6-8 glasses/day per <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/water-and-drinks/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Sleep Well', text: '7-9 hours/night per <a href="https://www.nhs.uk/conditions/insomnia/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Muscle Up', text: 'Lift weights via <a href="https://www.nhs.uk/live-well/exercise/">NHS</a> tips.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Stress Less', text: 'Meditate with <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Fibre Boost', text: '25g/day from <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">grains</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Heart Care', text: 'Cardio per <a href="https://www.who.int/news-room/fact-sheets/detail/cardiovascular-diseases-(cvds)">WHO</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Cholesterol', text: 'Test via <a href="https://www.nhs.uk/conditions/cholesterol/">NHS</a> yearly.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Bone Health', text: '1000mg calcium/day per <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">NHS</a>.' }
                    ];
                } else if (age < 40) {
                    advice = [
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Stay Active', text: '30 mins/day via <a href="https://www.nhs.uk/live-well/exercise/">NHS</a>‚Äîdance it out!' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v4"/></svg>', title: 'Portion Size', text: 'Cut 300 kcal/day with <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/portion-sizes/">plates</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Hydrate', text: '2L/day per <a href="https://www.cdc.gov/healthyweight/healthy_eating/water.html">CDC</a> for energy.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Lipid Check', text: 'Annual <a href="https://www.nhs.uk/conditions/cholesterol/">cholesterol</a> test.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Cardio Blast', text: '150 mins/week per <a href="https://www.who.int/news-room/fact-sheets/detail/physical-activity">WHO</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Strengthen', text: 'Lift weights via <a href="https://www.nhs.uk/live-well/exercise/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Sleep Rx', text: '7-9 hours/night per <a href="https://www.nhs.uk/conditions/insomnia/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Fibre Up', text: '30g/day via <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Stress Ease', text: 'Relax with <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">mindfulness</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Sugar Check', text: 'Test <a href="https://www.nhs.uk/conditions/type-2-diabetes/">glucose</a> levels.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Bone Care', text: 'Calcium via <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">NHS</a> (1000mg/day).' }
                    ];
                } else if (age < 50) {
                    advice = [
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Muscle Boost', text: 'Lift 2-3x/week per <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4066461/">studies</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Heart Pump', text: '150 mins/week <a href="https://www.nhs.uk/live-well/exercise/">cardio</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Health Scan', text: 'Check <a href="https://www.nhs.uk/conditions/type-2-diabetes/">sugar</a> and BP.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Fibre Fix', text: '30g/day from <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">grains</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v4"/></svg>', title: 'Hydration', text: '2L/day per <a href="https://www.cdc.gov/healthyweight/healthy_eating/water.html">CDC</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Sleep Well', text: '7-9 hours/night per <a href="https://www.nhs.uk/conditions/insomnia/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Joint Care', text: 'Low-impact via <a href="https://www.nhs.uk/conditions/arthritis/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Heart Check', text: 'Monitor <a href="https://www.nhs.uk/conditions/cholesterol/">lipids</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Mind Ease', text: 'Relax with <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">NHS</a> tips.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Bone Rx', text: 'Calcium (1000mg/day) per <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/calcium/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Energy Up', text: 'B12 via <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/vitamin-b/">NHS</a> (2.4mcg/day).' }
                    ];
                } else {
                    advice = [
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Gentle Moves', text: 'Yoga via <a href="https://www.nhs.uk/conditions/nhs-fitness-studio/yoga-for-seniors/">NHS</a> for joints.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6h4"/></svg>', title: 'Sleep Aid', text: '7-8 hours/night per <a href="https://www.nhs.uk/conditions/insomnia/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Bone Scan', text: 'Check <a href="https://www.nhs.uk/conditions/osteoporosis/">density</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Nutrition', text: '1500-1800 kcal with <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/vitamins-and-minerals-for-older-adults/">D</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Walk On', text: '30 mins/day per <a href="https://www.nhs.uk/live-well/exercise/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/></svg>', title: 'Strength', text: 'Light weights via <a href="https://www.nhs.uk/live-well/exercise/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v4"/></svg>', title: 'Hydrate', text: '6-8 glasses/day per <a href="https://www.cdc.gov/healthyweight/healthy_eating/water.html">CDC</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/></svg>', title: 'Fibre Aid', text: '20g/day via <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/fibre/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Heart Rx', text: 'Monitor <a href="https://www.nhs.uk/conditions/cholesterol/">lipids</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Mind Boost', text: 'Relax via <a href="https://www.nhsinform.scot/healthy-living/mental-wellbeing/">NHS</a>.' },
                        { icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Energy', text: 'B12 (2.4mcg/day) per <a href="https://www.nhs.uk/conditions/vitamins-and-minerals/vitamin-b/">NHS</a>.' }
                    ];
                }

                if (bmiValue < 18.5) {
                    advice.push({ icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>', title: 'Power Up', text: 'Add <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/underweight-and-weight-loss/">calorie-dense foods</a>‚Äînuts, cheese!' });
                    advice.push({ icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Doc Visit', text: 'Check for <a href="https://www.nhs.uk/conditions/malnutrition/">underlying issues</a>.' });
                } else if (bmiValue >= 30) {
                    advice.push({ icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>', title: 'Slim Down', text: 'Cut <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/eating-well/sugar/">sugar</a> to <70g/day, boost veg!' });
                    advice.push({ icon: '<svg class="recommendation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/></svg>', title: 'Health Plan', text: 'Consult for <a href="https://www.nhs.uk/conditions/obesity/treatment/">weight management</a>.' });
                }

                advice.forEach((rec, index) => {
                    const item = document.createElement('div');
                    item.className = 'recommendation-item';
                    item.style.animationDelay = `${index * 0.1}s`;
                    if (index % 2 === 0) item.classList.add('highlight-pulse');
                    item.innerHTML = `
                        <div class="recommendation-header">
                            <span class="recommendation-icon">${rec.icon}</span>
                            <h5 class="recommendation-title">${rec.title}</h5>
                        </div>
                        <p class="recommendation-text">${rec.text}</p>
                    `;
                    container.appendChild(item);
                });

                const refItem = document.createElement('div');
                refItem.className = 'recommendation-item highlight-pulse';
                refItem.innerHTML = `
                    <div class="recommendation-header">
                        <h5 class="recommendation-title">Further Research</h5>
                    </div>
                    <p class="recommendation-text">Dive deeper at <a href="https://www.nhsinform.scot/healthy-living/food-and-nutrition/">NHS Inform</a>, <a href="https://www.nhs.uk/live-well/healthy-weight/">NHS UK</a>, <a href="https://www.cdc.gov/healthyweight/assessing/bmi/index.html">CDC</a>, and <a href="https://www.who.int/health-topics/obesity">WHO</a>.</p>
                `;
                container.appendChild(refItem);
            }, 1000);
        }

        function saveRecord() {
            try {
                localStorage.setItem("bmiMeasurements", JSON.stringify(bmiMeasurements));
                
                const sendEmail = confirm("Record saved! Would you like to email your report?");
                if (sendEmail) {
                    openEmailComposer();
                }
            } catch (error) {
                console.error("Error in saveRecord:", error);
                alert("Error saving record!");
            }
        }

        function printReport() {
            try {
                const printContent = `
                    <style>
                        body { font-family: 'Quicksand', sans-serif; padding: 20px; }
                        h1 { color: #f00; text-align: center; }
                        h3 { color: #fff; }
                        p { color: #fff; margin: 10px 0; }
                        .print-container { background: #222; padding: 20px; border-radius: 10px; }
                    </style>
                    <div class="print-container">
                        <h1>Smart BMI Management Report</h1>
                        <h3>Name: ${latestMeasurement.name || '--'}</h3>
                        <p>Age: ${latestMeasurement.age || '--'}</p>
                        <p>Height: ${latestMeasurement.height || '--'} cm</p>
                        <p>Weight: ${latestMeasurement.weight || '--'} kg</p>
                        <p>BMI: ${latestMeasurement.bmi || '--'} (${latestMeasurement.category || '--'})</p>
                    </div>
                `;
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head><title>BMI Report</title></head>
                    <body>${printContent}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            } catch (error) {
                console.error("Error in printReport:", error);
                alert("Error generating report!");
            }
        }

        function openEmailComposer() {
            const email = prompt("Please enter your email address:");
            if (!email || !isValidEmail(email)) {
                alert("Please enter a valid email address.");
                return;
            }
            const emailSubject = encodeURIComponent("My BMI Management Report");
            const emailBody = prepareEmailBody();
            const mailtoLink = `mailto:${email}?subject=${emailSubject}&body=${emailBody}`;
            window.location.href = mailtoLink;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function prepareEmailBody() {
            const latestMeasurement = JSON.parse(localStorage.getItem("bmiMeasurements"))?.slice(-1)[0] || {
                name: "User", 
                age: "25", 
                height: "175", 
                weight: "70", 
                bmi: "22.9", 
                category: "Normal Weight"
            };
            const emailBodyText = `
BMI Management Report

Personal Details:
- Name: ${latestMeasurement.name}
- Age: ${latestMeasurement.age}
- Height: ${latestMeasurement.height} cm
- Weight: ${latestMeasurement.weight} kg

BMI Results:
- BMI Value: ${latestMeasurement.bmi}
- BMI Category: ${latestMeasurement.category}

Health Insights:
${getHealthInsightsSummary()}

Prescription Advice:
${getPrescriptionAdviceSummary()}

Disclaimer: This is a generated report. Please consult with a healthcare professional for personalized medical advice.

Generated by Smart BMI Management App
            `;
            return encodeURIComponent(emailBodyText);
        }

        function getHealthInsightsSummary() {
            const age = parseInt(latestMeasurement.age) || 25;
            const bmiValue = parseFloat(latestMeasurement.bmi) || 22.9;
            const insights = {
                youngAdult: [
                    "Peak Physical Health: Maintain balanced nutrition",
                    "Metabolism Shift: Be mindful of calorie intake",
                    "Stress Management: Important for overall health"
                ],
                middleAge: [
                    "Metabolic Slowdown: Monitor energy balance",
                    "Joint Health: Low-impact exercises recommended",
                    "Cardiovascular Awareness: Regular check-ups important"
                ],
                seniors: [
                    "Mobility Focus: Gentle exercises like walking",
                    "Nutritional Balance: Ensure adequate protein intake",
                    "Regular Health Screenings: Monitor overall wellness"
                ]
            };
            let selectedInsights = insights.youngAdult;
            if (age < 30) selectedInsights = insights.youngAdult;
            else if (age < 50) selectedInsights = insights.middleAge;
            else selectedInsights = insights.seniors;
            if (bmiValue < 18.5) {
                selectedInsights.push("Underweight Caution: Consult healthcare provider");
            } else if (bmiValue >= 30) {
                selectedInsights.push("Weight Management: Seek professional guidance");
            }
            return selectedInsights.map(insight => `- ${insight}`).join('\n');
        }

        function getPrescriptionAdviceSummary() {
            const age = parseInt(latestMeasurement.age) || 25;
            const bmiValue = parseFloat(latestMeasurement.bmi) || 22.9;
            const advice = {
                youngAdult: [
                    "150 mins/week moderate exercise",
                    "Balanced diet with whole grains",
                    "7-9 hours of sleep nightly"
                ],
                middleAge: [
                    "30 mins daily physical activity",
                    "Portion control for calorie management",
                    "Strength training 2-3 times weekly"
                ],
                seniors: [
                    "Gentle yoga or walking daily",
                    "Nutrient-rich diet with adequate protein",
                    "7-8 hours of quality sleep"
                ]
            };
            let selectedAdvice = advice.youngAdult;
            if (age < 30) selectedAdvice = advice.youngAdult;
            else if (age < 50) selectedAdvice = advice.middleAge;
            else selectedAdvice = advice.seniors;
            if (bmiValue < 18.5) {
                selectedAdvice.push("Increase calorie intake with healthy fats");
            } else if (bmiValue >= 30) {
                selectedAdvice.push("Reduce sugar and processed foods");
            }
            return selectedAdvice.map(advice => `- ${advice}`).join('\n');
        }
    </script>
</body>
</html>